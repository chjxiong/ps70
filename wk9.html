<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Documentation</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />

    <link
        href="./style.css"
        rel="stylesheet" type="text/css" />
   
    <style>
        ::selection {color: #f0f0f0; background: #333333;}
    </style>    

    <script type="text/javascript">WebFont.load({ google: { families: ["Inconsolata:400,700"] } });</script>
    <link href="./Source/webicon.jpg" rel="shortcut icon" type="image/x-icon" />


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/arduino.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="body">
    <div class="documentation-page-1">
        
        <div class="block_name">
            <a href="./index.html" class="name-white">chenjie's site for ps70</a>
        </div>

        <div class="block_navigation">
            <a href="./index.html" class="navigation-link-white">home</a>
            <a href="./documentation.html" class="navigation-link-white">documentation</a>
            <a href="./about.html" class="navigation-link-white">about</a>
            <a href="./final project.html" class="navigation-link-white">final project</a>
        </div>
        
        <a class="block_timeline2 inline-block">
            <img src="./Source/WK9/schedule.png" loading="lazy" alt="" class="week-image" />
        </a>

        <div class="timeline2">
      
            <a href="./wk1.html" class="icon-links inline-block">
              <img src="./Source/icon-02.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-17.png" loading="lazy" width="49" alt="" class="icon" />
            </a>
          
            <a href="./wk2.html" class="icon-links inline-block">
              <img src="./Source/icon-03.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-18.png" loading="lazy" alt="" class="icon" />
            </a>
                
            <a href="./wk3.html" class="icon-links inline-block">
              <img src="./Source/icon-04.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-19.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk4.html" class="icon-links inline-block">
              <img src="./Source/icon-05.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-20.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk5.html" class="icon-links inline-block">
              <img src="./Source/icon-06.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-21.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk6.html" class="icon-links inline-block">
              <img src="./Source/icon-07.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-22.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk7.html" class="icon-links inline-block">
              <img src="./Source/icon-08.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-23.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk8.html" class="icon-links inline-block">
              <img src="./Source/icon-09.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-24.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk9.html" class="icon-links inline-block">
              <img src="./Source/icon-10.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-25.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk10.html" class="icon-links inline-block">
              <img src="./Source/icon-11.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-26.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk11.html" class="icon-links inline-block">
              <img src="./Source/icon-12.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-27.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk12.html" class="icon-links inline-block">
              <img src="./Source/icon-13.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-28.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk13.html" class="icon-links inline-block">
              <img src="./Source/icon-14.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-29.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk14.html" class="icon-links inline-block">
              <img src="./Source/icon-15.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-30.png" loading="lazy" alt="" class="icon" />
            </a>
            
            <a href="./wk15.html" class="icon-links inline-block">
              <img src="./Source/icon-16.png" loading="lazy" alt="" class="icon-2" />
              <img src="./Source/icon-31.png" loading="lazy" alt="" class="icon" />
            </a>
        </div>

        <div class="timeline-img">
            <img src="./Source/timeline.png" loading="lazy" sizes="100vw" alt="" />
        </div>

    </div>


    <div class="documentation-page-2">
        
        <div class="title">WK9: Radio, WiFi, Bluetooth (IoT)</div>
        <br>
        <div class="description">
          Work with Yutong Wang
        </div>
        <div class="subtitle">Schedule Display </div>
        <div class="description">
          By using ESP32, Firebase and LCD screen, 
          users can input their schedule including dates and events on the website, 
          and the input informaiton will be displayed on the LCD screen subsequently.
          <br>
          <a href="./Source/WK9/website.html">This is the website for user input.</a>
        </div>

        <a class="doc-page-image-block inline-block">
          <img src="./Source/WK9/user-interface.png" loading="lazy" sizes="100vw" alt="" class="doc-page-image" />
          </a>
          <div class="caption">User website</div>
          
          <div class="description">
            ESP32 XIAO is not compatible for the LCD for some reason,
            so we used ESP32 DEVKIT instead. 
            <a href="https://randomnerdtutorials.com/esp32-esp8266-i2c-lcd-arduino-ide/">Here</a> 
            is the website tutorial talking about using LCD with ESP32.
          </div>
          
        <a class="doc-page-image-block inline-block">
          <img src="./Source/WK9/wireup.JPG" loading="lazy" sizes="100vw" alt="" class="doc-page-image" />
          </a>
          <div class="caption">Wire up</div>

          <a class="doc-page-image-block inline-block">
            <img src="./Source/WK9/circuits.png" loading="lazy" sizes="100vw" alt="" class="doc-page-image" />
            </a>
            <div class="caption">Circuits. Source: https://randomnerdtutorials.com/esp32-esp8266-i2c-lcd-arduino-ide/</div>

        <a class="doc-page-image-block inline-block">
        <img src="./Source/WK9/firebase-realtime-data.png" loading="lazy" sizes="100vw" alt="" class="doc-page-image" />
        </a>
        <div class="caption">Real-time data in Firebase</div>
        
        <video class="doc-page-image-block inline-block" controls>
          <source src="./Source/WK9/screen.mp4" type="video/mp4">
        </video> 
        <div class="caption">When the user input the date and event informaiton, it will be shown on the screen.</div>
        

        <div class="description">
          The codes were much more complex than expected. 
          It seems that the template codes on the ps70 website have not been updated, leading to some bugs popping up.
        

        </div>

        <br>
        <div class="description">
         codes for arduino
        </div>
        <pre style="width: 45vw; height: 60vh; overflow: scroll;"><code>
          #include <WiFi.h>
            #include <Firebase_ESP_Client.h>
            #include <Arduino.h>
            //Provide the token generation process info.
            #include "addons/TokenHelper.h"
            //Provide the RTDB payload printing info and other helper functions.
            #include "addons/RTDBHelper.h"
            
            #define DATABASE_URL "https://ps70-assignment-9-default-rtdb.firebaseio.com/" 
            #define API_KEY "AIzaSyDQLa0yHfCj-yF4qb3oo5hCBFqBPJmPdmw"
            
            #define WIFI_SSID "MAKERSPACE"
            #define WIFI_PASSWORD "12345678"
            unsigned long sendDataPrevMillis = 0;
            int count = 0;
            bool signupOK = false;
            unsigned long prevMillis = 0;
            const long interval = 5000; // Check every 5 seconds
            
            // Define Firebase Data object
            FirebaseData fbdo;
            
            FirebaseAuth auth;
            FirebaseConfig config;
            
            #include <LiquidCrystal_I2C.h>
             
            // set the LCD number of columns and rows
            int lcdColumns = 16;
            int lcdRows = 2;
             
            // set LCD address, number of columns and rows
            // if you don't know your display address, run an I2C scanner sketch
            LiquidCrystal_I2C lcd(0x27, lcdColumns, lcdRows);  
            
            void setup() {
              Serial.begin(115200);
              WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
              Serial.print("Connecting to Wi-Fi");
              while (WiFi.status() != WL_CONNECTED){
                Serial.print(".");
                delay(300);
              }
              Serial.println();
              Serial.print("Connected with IP: ");
              Serial.println(WiFi.localIP());
              Serial.println();
            
              /* Assign the API key (required) */
              config.api_key = API_KEY;
            
              /* Assign the RTDB URL (required) */
              config.database_url = DATABASE_URL;
            
              /* Sign up */
              if (Firebase.signUp(&config, &auth, "", "")){
                Serial.println("OK");
                signupOK = true;
              }
              else{
                Serial.printf("%s\n", config.signer.signupError.message.c_str());
              }
            
              /* Assign the callback function for the long running token generation task */
              config.token_status_callback = tokenStatusCallback; //see addons/TokenHelper.h
              
              Firebase.begin(&config, &auth);
              Firebase.reconnectWiFi(true);
              // put your setup code here, to run once:
              if (!Firebase.RTDB.beginStream(&fbdo, "/events"))
              {
                Serial.println(fbdo.errorReason());
              }
            
            
                 // initialize LCD
              lcd.init();
              // turn on LCD backlight                      
              lcd.backlight();
            }
            
            void loop() {
              // put your main code here, to run repeatedly:
              if (!Firebase.RTDB.readStream(&fbdo))
              {
                Serial.println(fbdo.errorReason());
              }
            
              if (fbdo.streamTimeout())
              {
                Serial.println("Stream timeout, resume streaming...");
                Serial.println();
              }
            
              if (fbdo.streamAvailable())
              {
                if (fbdo.dataTypeEnum() == firebase_rtdb_data_type_integer)
                  Serial.println(fbdo.to<int>());
                else if (fbdo.dataTypeEnum() == firebase_rtdb_data_type_float)
                  Serial.println(fbdo.to<float>(), 5);
                else if (fbdo.dataTypeEnum() == firebase_rtdb_data_type_double)
                  printf("%.9lf\n", fbdo.to<double>());
                else if (fbdo.dataTypeEnum() == firebase_rtdb_data_type_boolean)
                  Serial.println(fbdo.to<bool>() ? "true" : "false");
                else if (fbdo.dataTypeEnum() == firebase_rtdb_data_type_string)
                  Serial.println(fbdo.to<String>());
                else if (fbdo.dataTypeEnum() == firebase_rtdb_data_type_json)
                {
                    Serial.println("in the json for loop");
                    FirebaseJson *json = fbdo.to<FirebaseJson *>();
                    Serial.println(json->raw());
                    FirebaseJsonData event;
                    json->get(event, "event");
                    Serial.println(event.to<String>());
                    FirebaseJsonData date;
                    json->get(date, "date");
                    Serial.println(date.to<String>());
                    
                  lcd.setCursor(0, 0);
              // print message
              lcd.print(date.to<String>());
              delay(1000);
              // clears the display to print new message
              
              // set cursor to first column, second row
              lcd.setCursor(0,1);
              lcd.print(event.to<String>());
              delay(3000);
              lcd.clear(); 
                }
                else if (fbdo.dataTypeEnum() == firebase_rtdb_data_type_array)
                {
                    FirebaseJsonArray *arr = fbdo.to<FirebaseJsonArray *>();
                    Serial.println(arr->raw());
                }
            
              }
          
            }
            
        </code></pre> 
        <br>
        <div class="description">
          codes for the website
         </div>
         <div class="description">
         <pre style="width: 45vw; height: 60vh; overflow: scroll;"><code>
          <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Input Form</title>
</head>
<body>
  <h1>Event Input Form</h1>
  <form id="eventForm">
    <label for="date">Date:</label>
    <input type="date" id="date" name="date" required><br><br>
    <label for="event">Event:</label>
    <input type="text" id="event" name="event" required><br><br>
    <button type="submit">Submit</button>
  </form>

  <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-database.js"></script>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDQLa0yHfCj-yF4qb3oo5hCBFqBPJmPdmw",
        authDomain: "ps70-assignment-9.firebaseapp.com",
        databaseURL: "https://ps70-assignment-9-default-rtdb.firebaseio.com",
        projectId: "ps70-assignment-9",
        storageBucket: "ps70-assignment-9.appspot.com",
        messagingSenderId: "615712637717",
        appId: "1:615712637717:web:b5806df75154bc40f01f1c",
        measurementId: "G-5JTDL6XQXR"
    };

    firebase.initializeApp(firebaseConfig);
  
    // Get a reference to the database service
    const database = firebase.database();

    document.getElementById("eventForm").addEventListener("submit", function(event) {
      event.preventDefault();
      
      const dateInput = document.getElementById("date").value;
      const eventInput = document.getElementById("event").value;

      // Create a new Date object from the input value
      const eventDate = new Date(dateInput);

      // Check if the date is valid
      if (!isNaN(eventDate.getTime())) {
        // Format the date as "Day, Month, Year"
        const formattedDate = eventDate.toLocaleDateString('en-US', {
          day: 'numeric', month: 'long', year: 'numeric'
        });

        // Store the formatted date and event description in Firebase
        database.ref('events').push({
          date: formattedDate,
          event: eventInput
        });

        // Clear the form after submission
        document.getElementById("eventForm").reset();
      } else {
        console.error("Invalid date input");
      }
    });
  </script>
</body>
</html>
        </code></pre> </div>
    </div>



      
    <div class="space"></div>
    


</body>

</html>